<!DOCTYPE html>
<html th:replace="~{layout :: layout(~{::title}, ~{::section})}" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Your Cart - Ecommerce Demo</title>
</head>

<body>
    <section>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>Your Shopping Cart</h1>
            <div th:if="${selectedUser}" class="user-info">
                Logged in as: <strong th:text="${selectedUser.username}">User</strong>
            </div>
        </div>

        <div th:if="${selectedUser == null}" class="card" style="text-align: center; margin-top: 2rem;">
            <p>Please <a th:href="@{/auth/login}">login</a> to view your cart.</p>
        </div>

        <div th:if="${selectedUser != null}">
            <h2 style="margin-top: 1rem; color: var(--muted); font-size: 1.2rem;">
                Items in your cart
            </h2>

            <div th:if="${#lists.isEmpty(cart.items)}" class="card" style="text-align: center;">
                <p>This cart is empty.</p>
                <a th:href="@{/products}" class="btn">Go Shop</a>
            </div>

            <div th:if="${not #lists.isEmpty(cart.items)}">
                <table>
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Qty</th>
                            <th>Subtotal</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="item : ${cart.items}">
                            <td th:text="${item.productName}">Product</td>
                            <td th:text="'$' + ${item.price}">$0.00</td>
                            <td>
                                <form th:action="@{/cart/update}" method="post"
                                    style="display: flex; align-items: center; gap: 5px;">
                                    <input type="hidden" name="productId" th:value="${item.productId}">
                                    <input type="number" name="quantity" th:value="${item.quantity}" min="1"
                                        style="width: 60px; padding: 5px;" onchange="this.form.submit()">
                                    <button type="submit" class="btn btn-sm"
                                        style="padding: 2px 8px; font-size: 0.8rem;">Update</button>
                                </form>
                            </td>
                            <td th:text="'$' + ${item.price * item.quantity}">$0.00</td>
                            <td>
                                <a th:href="@{/cart/remove/{id}(id=${item.productId})}"
                                    style="color: var(--danger); font-weight: bold; text-decoration: none;">&times;
                                    Remove</a>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3" style="text-align: right;">Total:</th>
                            <th th:text="'$' + ${cart.total}">$0.00</th>
                            <th></th>
                        </tr>
                    </tfoot>
                </table>
                <div style="display: flex; gap: 10px;">
                    <a th:href="@{/cart/clear}" class="btn btn-secondary">Clear Cart</a>
                    <button class="btn" onclick="alert('Checkout process starting...')">Checkout Now</button>
                </div>
            </div>
        </div>
    </section>
</body>

</html>